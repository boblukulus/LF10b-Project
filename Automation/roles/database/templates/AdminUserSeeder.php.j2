namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\Hash;
use Pterodactyl\Models\User;
use Illuminate\Support\Str;

class AdminUserSeeder extends Seeder
{
    public function run(): void
    {
        $email = '{{ pterodactyl_user.admin_email }}';
        $password = '{{ pterodactyl_user.admin_password }}';

        $admin = User::where('email', $email)->first();

        if ($admin) {
            // Passwort und ggf. andere Daten aktualisieren
            $admin->update([
                'username'   => '{{ pterodactyl_user.admin_username }}',
                'name_first' => '{{ pterodactyl_user.admin_firstname }}',
                'name_last'  => '{{ pterodactyl_user.admin_lastname }}',
                'password'   => Hash::make($password),
                'root_admin' => true,
            ]);

            $this->command->info("Admin user with email {$email} updated successfully.");
            return;
        }

        // Benutzer erstellen, falls noch nicht vorhanden
        User::create([
            'uuid'       => (string) Str::uuid(),
            'username'   => '{{ pterodactyl_user.admin_username }}',
            'email'      => $email,
            'name_first' => '{{ pterodactyl_user.admin_firstname }}',
            'name_last'  => '{{ pterodactyl_user.admin_lastname }}',
            'password'   => Hash::make($password),
            'root_admin' => true,
            'language'   => 'en',
        ]);

        $this->command->info('Admin user created successfully.');
    }
}
